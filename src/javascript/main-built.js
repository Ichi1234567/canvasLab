((function(){define("objData/objData",[],function(){var a,b;return console.log("---objData---"),b=function(a){var b,c,d;return c={v:[],f:[]},b=a.split("\n"),d=[0,0],b.forEach(function(a){var b,e,f;if(a.length){f=a.split(" "),b=f[0].replace("_","");switch(!0){case/^v/g.test(a):case/_cp/g.test(a):return e=f.slice(1),!c[b]&&(c[b]=[]),b!=="cp"?(d.forEach(function(a,b){return e[b]=parseFloat(e[b]),d[b]+=e[b],c.min||(c.min=[],c.max=[]),typeof c["min"][b]!="number"&&(c.min[b]=e[b],c.max[b]=e[b]),c.min[b]=Math.min(c.min[b],e[b]),c.max[b]=Math.max(c.max[b],e[b])}),c[b].push(e)):e.forEach(function(a){return c[b].push(parseFloat(a))});case/^f/g.test(a):return e=f.slice(1),c[b].push(e);case/^_g/g.test(a):case/^_v/g.test(a):case/^_f/g.test(a):case/^r/g.test(a):return e=f[1],(b==="f"||b==="v")&&(b+="num"),b!=="g"&&(e=parseFloat(e)),c[b]=e;default:return e=f.slice(1),c[b]=e}}}),!c.g&&(c.g=""),!c.vnum&&(c.vnum=c.v.length),!c.fnum&&(c.fnum=c.f.length),!c.cp&&(c.cp=[d[0]/c.vnum,d[1]/c.vnum]),c.r?(c.size=[],c.size=[2*c.r,2*c.r],c.cp.forEach(function(a,b){var d;return d=c.r,c.min[b]=a-d,c.max[b]=a+d,c.size[b]=2*d})):(c.size=[],c.min.forEach(function(a,b){return c.size[b]=c.max[b]-c.min[b]})),c},a=Backbone.Model.extend({initialize:function(a){return a[1]==="success"&&(this.data=b(a[0]),this.data.mtxScript=[],this.data.mode="GENERAL"),this.data.prevMtx=[],this},clearMtx:function(a){return this.data.prevMtx=[],this.data.mtxScript=[]},resetMtx:function(a){return this.data.prevMtx=this.data.mtxScript,this.data.mtxScript=[]},pushMtx:function(a,b){return this.data.mtxScript.push([a,b])}}),a})})).call(this),function(){define("objData/reader",["objData/objData"],function(a){return console.log("---reader---"),jQuery.fn.readObjEvt=function(b){var c,d;return b=typeof b=="object"?b:{},d=typeof b.done=="function"?b.done:function(){},c=this,c.bind("change",function(b){var e,f,g,h,i;i=c.attr("type");switch(i){case"radio":return e=c.filter(":checked"),f=e.attr("val"),$.ajax({type:"GET",url:f,contentType:"application/x-www-form-urlencoded;charset=utf-8"}).done(function(){var b;return b=new a(arguments),d(b)}).fail(function(){return alert("The file cant be found.")});case"file":g=c.get(0).files[0];if(!g.name.match(/\.obj$/)){alert("Please select a .obj file.");return}return h=new FileReader,h.onload=function(b){var c,e;return e=b.target.result.length?"success":"fail",c=new a([b.target.result,e,b]),d(c)},h.readAsText(g)}})}})}.call(this),function(){define("geom/geom",[],function(){var a;return a={lookAt:function(a,b){var c,d,e,f,g;e=b.display,g=e.w,f=e.h,d=e.ctx;if(a&&a.length===2)return c=[g/2,f/2],d[0].setTransform(1,0,0,1,c[0]-a[0],c[1]-a[1]),d[1].setTransform(1,0,0,1,c[0]-a[0],c[1]-a[1]),e.at=a.map(function(a){return a})},scale:function(a,b){var c,d,e,f,g;e=b.display,d=e.ctx,c=b.center;if(a&&a.length===2)return f=c[0]-c[0]*a[0],g=c[1]-c[1]*a[1],d[0].transform(a[0],0,0,a[1],f,g),d[1].transform(a[0],0,0,a[1],f,g)},move:function(a,b){var c,d,e;e=b.display,d=e.ctx,c=b.center;if(a&&a.length===2)return d[0].transform(1,0,0,1,a[0],a[1]),d[1].transform(1,0,0,1,a[0],a[1])},moveTo:function(a,b){var c,d,e,f,g;e=b.display,d=e.ctx,c=b.center;if(a&&a.length===2)return f=a[0]-c[0],g=a[1]-c[1],d[0].transform(1,0,0,1,f,g),d[1].transform(1,0,0,1,f,g)},transform:function(a,b){var c,d,e,f,g;e=b.display,d=e.ctx,c=b.center;if(a&&a.length===6)return f=c[0]-c[0]*a[0],g=c[1]-c[1]*a[3],d[0].transform(a[0],a[1],a[2],a[3],f+a[4],g+a[5]),d[1].transform(a[0],a[1],a[2],a[3],f+a[4],g+a[5])},rotate:function(b,c){var d,e,f,g,h;g=c.display,f=g.ctx,d=c.center;if(typeof b=="number")return e=[d[0]*Math.cos(b)+d[1]*Math.sin(b),-d[0]*Math.sin(b)+d[1]*Math.cos(b)],h=[e[0]-d[0],e[1]-d[1]],f[0].rotate(b),f[1].rotate(b),a.move(h,c)},unwrapMtx:function(b,c){return b.forEach(function(b){var d,e;return d=b[0],e=b[1],a[d](e,c)})}},a})}.call(this),function(){define("display/display",["../geom/geom"],function(a){var b,c,d;return c={noFace:function(a){var b,c,d,e,f,g,h;d=a.data,c=a.ctx,b=a.cb?a.cb:function(){},h=d.vnum,f=d.v,c.beginPath(),c.moveTo(f[0][0],f[0][1]);for(e=1;1<=h?e<=h:e>=h;1<=h?e++:e--)g=f[e],c.lineTo(g[0],g[1]);return b()},hasFace:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;e=a.data,d=a.ctx,c=a.cb?a.cb:function(){},o=a.type,j=e.fnum,f=e.f,p=e.v;switch(o){case"fill":n=function(a,b,c){var d,e;return d=a.split("/"),e=parseInt(d[0]),c.lineTo(b[e][0],b[e][1]),!1};break;default:n=function(a,b,c,d){var e,f;return e=a.split("/"),f=parseInt(e[0]),d?c.moveTo(b[f][0],b[f][1]):c.lineTo(b[f][0],b[f][1]),d=e.length>1?!parseInt(e[1]):!1,d}}s=[];for(k=0,q=f.length;k<q;k++){h=f[k],d.beginPath(),b=!0;for(m=0,r=h.length;m<r;m++)i=h[m],b=n(i,p,d,b);g=h[0].split("/"),l=parseInt(g[0]),b?d.moveTo(p[l][0],p[l][1]):d.lineTo(p[l][0],p[l][1]),s.push(c())}return s}},d={polyEdge:function(a,b){var d,e,f,g,h;f=b.display,e=f.current,d=f.ctx[e],g=b.mode,h=b.style_edge;if(g==="SKELETON")return a.f&&c.hasFace({data:a,ctx:d,cb:function(){return h&&f.setStyle(h),d.stroke()}}),!a.f&&c.noFace({data:a,ctx:d,cb:function(){return h&&f.setStyle(h),d.stroke()}})},polyFill:function(a,b){var d,e,f,g;return f=b.display,e=f.current,d=f.ctx[e],g=b.style_fill,c.hasFace({data:a,ctx:d,type:"fill",cb:function(){return g&&f.setStyle(g),d.fill()}})},cirEdge:function(a,b){var c,d,e,f,g,h,i;return e=b.display,d=e.current,c=e.ctx[d],f=b.mode,h=b.style_edge,f==="SKELETON"&&(i=a.v,g=a.r,c.beginPath(),c.arc(i[0][0],i[0][1],g,0,Math.PI*2,!1),c.closePath()),h&&e.setStyle(h),c.stroke()},cirFill:function(a,b){var c,d,e,f,g,h;return e=b.display,d=e.current,c=e.ctx[d],g=b.style_fill,h=a.v,f=a.r,c.beginPath(),c.arc(h[0][0],h[0][1],f,0,Math.PI*2,!1),c.closePath(),g&&e.setStyle(g),c.fill()}},console.log("---display---"),b=Backbone.Model.extend({initialize:function(a){return this.current=0,this.w=a.width,this.h=a.height,this.canvas=[$("<canvas></canvas>").css({display:"block"}),$("<canvas></canvas>").css({display:"none"})],this.canvas[0].get(0).width=this.w,this.canvas[0].get(0).height=this.h,this.canvas[1].get(0).width=this.w,this.canvas[1].get(0).height=this.h,this.ctx=[this.canvas[0].get(0).getContext("2d"),this.canvas[1].get(0).getContext("2d")],a.display.append(this.canvas[0]).append(this.canvas[1]),this.lookat=[this.w/2,this.h/2],this},switchCanvas:function(a){var b,c,d;return a=a?a:{},d=a.prev,b=a.current,c=["block","none"],this.clear(),this.canvas[b].css("display",c[0]),this.canvas[d].css("display",c[1]),this.current=b,this},clear:function(a){var b,c,d,e,f;return a=a?a:{},b=this.current,e=a.x?a.x:0,f=a.y?a.y:0,d=a.w?a.w:this.w,c=a.h?a.h:this.h,this.ctx[b].setTransform(1,0,0,1,0,0),this.ctx[b].clearRect(e,f,d,c),this},setStyle:function(a){var b,c,d,e;a=a?a:{},c=this.current,b=this.ctx[c];for(e in a)d=a[e],b[d]=e;return this},lookAt:function(b){if(b&&b.length===2)return this.lookat=b,a.lookAt(b,{display:this})},updateCanvas:function(b){var c,e,f,g,h,i,j,k,l,m,n,o,p,q;b=b?b:{},m=b.mode,i=b.data,f=b.cb?b.cb:function(){},p=this.current,h=(this.current+1)%2,this.switchCanvas({prev:p,current:h}),e=this.canvas[h],g=this.ctx[h],o=this.ctx[p],c=this.at,a.lookAt(c,{display:this});for(l=0,q=i.length;l<q;l++){j=i[l],n=m?m:j.mode;switch(n){case"SKELETON":k=function(a,b){return!a.r&&d.polyEdge(a,b),a.r&&d.cirEdge(a,b)};break;case"ONLYFACE":k=function(a,b){return!a.r&&d.polyFill(a,b),a.r&&d.cirFill(a,b)};break;default:m="GENERAL",k=function(a,b){return a.r&&(d.cirFill(a,b),d.cirEdge(a,b)),a.f&&d.polyFill(a,b),!a.r&&d.polyEdge(a,b)}}g.save(),o.save(),a.unwrapMtx(j.mtxScript,{display:this,center:j.cp}),k(j,{display:this,mode:n,style_edge:b.style_edge?b.style_edge:null,style_fill:b.style_fill?b.style_fill:null}),g.restore(),o.restore()}return this.mode=m,f(),this}}),b})}.call(this),function(){require(["objData/reader","display/display"],function(a,b){var c,d,e;return console.log("---main-read---"),c=null,e=null,d=function(a){var d,f;return e=a,d=a.data,f=d.g?d.g:"--",$("#name").html(f),$("#ctx-title").html(f),f=d.vnum,$("#vnum").html(f),f=d.fnum?d.fnum:"--",$("#fnum").html(f),f=d.r?d.r:"--",$("#r").html(f),$("#cp").html(d.cp.join(" , ")),$("#size").html(d.size.join(" , ")),function(a){var b;return b=a.map(function(a){return a.join(" , ")}).join("<br>"),$("#v").html(b)}(d.v),function(a){var b;return b=a.map(function(a){return a.join(" , ")}).join("<br>"),$("#f").html(b)}(d.f),c||(c=new b({display:$("#render"),width:800,height:600})),c.lookAt(d.cp,{display:c}),c.updateCanvas({data:[d],mode:$("input[name=mode]:checked").attr("val"),cb:function(){}})},$("#mymodel").readObjEvt({done:d}),$("input[name=shape]").readObjEvt({done:d}),$("input[name=mode]").bind("change",function(){if(c&&e)return c.updateCanvas({data:[e.data],mode:$("input[name=mode]:checked").attr("val"),cb:function(){}})})})}.call(this),define("main-reader",function(){})